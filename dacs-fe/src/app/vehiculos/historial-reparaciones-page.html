<div class="historial-wrapper">
  <div class="historial-card">
    <div class="historial-header">
      <h2 class="page-title">Historial de reparaciones</h2>
      <div class="actions">
        <input placeholder="Buscar por responsable" class="search" (input)="onSearchInput($event)" (keyup.enter)="searchByTerm()" [value]="searchTerm" />
        <button class="search-btn" (click)="searchByTerm()">Buscar</button>
        <button *ngIf="searchTerm" class="clear-btn" (click)="clearSearch()">Limpiar</button>
        <button class="new-btn" (click)="crearNueva()">Nueva reparación</button>
      </div>
    </div>

    <div *ngIf="loading" class="loading">Cargando reparaciones...</div>

    <div *ngIf="!loading && displayedReparaciones.length === 0" class="empty">
      <p>No existen reparaciones para este vehículo.</p>
    </div>

    <div *ngIf="!loading && displayedReparaciones.length > 0" class="list">
      <div *ngFor="let r of displayedReparaciones" class="repair-item">
        <div class="repair-icon" aria-hidden="true">
          <!-- wrench icon -->
          <svg width="44" height="44" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M20.7 5.3l-2-2a1 1 0 00-1.4 0l-1 1 3.4 3.4 1-1a1 1 0 000-1.4z" fill="#2f3940"/>
            <path d="M18.3 6.7L12 13v4h4l6.3-6.3-4-4z" fill="#2f3940"/>
          </svg>
        </div>
        <div class="repair-info">
          <div class="responsable">{{ r.responsable || 'Responsable' }}</div>
          <div class="dates">Ingreso: {{ r.fechaIngreso || r.fecha_ingreso || '-' }} &nbsp; | &nbsp; Egreso: {{ r.fechaEgreso || r.fecha_egreso || '-' }}</div>
        </div>
        <div class="repair-controls">
          <button class="btn-small" (click)="goToDetalle(r); $event.stopPropagation()" title="Ver detalle">Ver</button>
          <button class="btn-small" (click)="goToEdit(r); $event.stopPropagation()" title="Editar">Editar</button>
        </div>
      </div>
    </div>

    <div *ngIf="error" class="error">{{ error }}</div>

    <div class="card-footer">
      <button class="cancel-btn" (click)="cancelar()">Cancelar</button>
    </div>
  </div>
</div>
